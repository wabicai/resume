<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript代码安全规范 | wabicai的个人空间</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="前端、后端、互联网前沿学习等等">
    
    <link rel="preload" href="/assets/css/0.styles.1ce20086.css" as="style"><link rel="preload" href="/assets/js/app.87bfd1af.js" as="script"><link rel="preload" href="/assets/js/2.e7cb0910.js" as="script"><link rel="preload" href="/assets/js/56.4fa9742c.js" as="script"><link rel="prefetch" href="/assets/js/10.efffd37f.js"><link rel="prefetch" href="/assets/js/100.282714ae.js"><link rel="prefetch" href="/assets/js/101.c1870e60.js"><link rel="prefetch" href="/assets/js/102.20b43498.js"><link rel="prefetch" href="/assets/js/103.8f3c31ab.js"><link rel="prefetch" href="/assets/js/104.9dae1125.js"><link rel="prefetch" href="/assets/js/105.14284268.js"><link rel="prefetch" href="/assets/js/106.7c50adb0.js"><link rel="prefetch" href="/assets/js/107.210927a0.js"><link rel="prefetch" href="/assets/js/108.e360b9e4.js"><link rel="prefetch" href="/assets/js/109.098f2401.js"><link rel="prefetch" href="/assets/js/11.294751e4.js"><link rel="prefetch" href="/assets/js/110.4f2dc0bb.js"><link rel="prefetch" href="/assets/js/111.5e633760.js"><link rel="prefetch" href="/assets/js/112.f75779da.js"><link rel="prefetch" href="/assets/js/113.941ccc36.js"><link rel="prefetch" href="/assets/js/114.4a824410.js"><link rel="prefetch" href="/assets/js/115.25673c0e.js"><link rel="prefetch" href="/assets/js/116.bafed480.js"><link rel="prefetch" href="/assets/js/117.6aebfbde.js"><link rel="prefetch" href="/assets/js/118.e55e70e7.js"><link rel="prefetch" href="/assets/js/119.2c378585.js"><link rel="prefetch" href="/assets/js/12.e9374bb7.js"><link rel="prefetch" href="/assets/js/120.abf566d6.js"><link rel="prefetch" href="/assets/js/121.17c731d9.js"><link rel="prefetch" href="/assets/js/122.d766a408.js"><link rel="prefetch" href="/assets/js/123.64079373.js"><link rel="prefetch" href="/assets/js/124.2e35c79f.js"><link rel="prefetch" href="/assets/js/125.0317e044.js"><link rel="prefetch" href="/assets/js/126.b5bc79a0.js"><link rel="prefetch" href="/assets/js/127.c671ca59.js"><link rel="prefetch" href="/assets/js/128.ff2745ec.js"><link rel="prefetch" href="/assets/js/129.f8f8c3c8.js"><link rel="prefetch" href="/assets/js/13.b739fbeb.js"><link rel="prefetch" href="/assets/js/130.7f336a84.js"><link rel="prefetch" href="/assets/js/131.4bd8771e.js"><link rel="prefetch" href="/assets/js/132.f0c0f2e4.js"><link rel="prefetch" href="/assets/js/133.dc2f34f6.js"><link rel="prefetch" href="/assets/js/134.dee60b5b.js"><link rel="prefetch" href="/assets/js/135.e2dfd7fa.js"><link rel="prefetch" href="/assets/js/136.450499d8.js"><link rel="prefetch" href="/assets/js/137.b8f85dc0.js"><link rel="prefetch" href="/assets/js/138.abc90831.js"><link rel="prefetch" href="/assets/js/139.0eb2eb0f.js"><link rel="prefetch" href="/assets/js/14.f40db515.js"><link rel="prefetch" href="/assets/js/140.6ab917f5.js"><link rel="prefetch" href="/assets/js/141.ac68ab0c.js"><link rel="prefetch" href="/assets/js/142.3df911bf.js"><link rel="prefetch" href="/assets/js/143.77ae04f1.js"><link rel="prefetch" href="/assets/js/144.008d1127.js"><link rel="prefetch" href="/assets/js/145.44ecf828.js"><link rel="prefetch" href="/assets/js/146.8f5e2cf9.js"><link rel="prefetch" href="/assets/js/147.1be176b3.js"><link rel="prefetch" href="/assets/js/148.3e2bd7e6.js"><link rel="prefetch" href="/assets/js/149.ba154ca4.js"><link rel="prefetch" href="/assets/js/15.d7cac606.js"><link rel="prefetch" href="/assets/js/150.84c18ee2.js"><link rel="prefetch" href="/assets/js/151.c619c1ae.js"><link rel="prefetch" href="/assets/js/152.d191e9ef.js"><link rel="prefetch" href="/assets/js/153.45758b9e.js"><link rel="prefetch" href="/assets/js/154.ba954ea3.js"><link rel="prefetch" href="/assets/js/155.bcc97f8c.js"><link rel="prefetch" href="/assets/js/156.38918a84.js"><link rel="prefetch" href="/assets/js/157.42a36d4d.js"><link rel="prefetch" href="/assets/js/158.6adda65c.js"><link rel="prefetch" href="/assets/js/159.b6821ba6.js"><link rel="prefetch" href="/assets/js/16.fcb940bf.js"><link rel="prefetch" href="/assets/js/160.5bc2617a.js"><link rel="prefetch" href="/assets/js/161.21314b9b.js"><link rel="prefetch" href="/assets/js/162.7c22e247.js"><link rel="prefetch" href="/assets/js/163.6ef43025.js"><link rel="prefetch" href="/assets/js/164.2775f3ee.js"><link rel="prefetch" href="/assets/js/165.5a6b3611.js"><link rel="prefetch" href="/assets/js/166.46204d30.js"><link rel="prefetch" href="/assets/js/167.795f72a7.js"><link rel="prefetch" href="/assets/js/168.58e4a2d2.js"><link rel="prefetch" href="/assets/js/169.7c1af7c4.js"><link rel="prefetch" href="/assets/js/17.ca60f6d7.js"><link rel="prefetch" href="/assets/js/170.3d82983a.js"><link rel="prefetch" href="/assets/js/171.7900fc5a.js"><link rel="prefetch" href="/assets/js/172.68f22d84.js"><link rel="prefetch" href="/assets/js/173.32293ed2.js"><link rel="prefetch" href="/assets/js/174.86e6f041.js"><link rel="prefetch" href="/assets/js/175.a702c5e0.js"><link rel="prefetch" href="/assets/js/176.d1a64462.js"><link rel="prefetch" href="/assets/js/177.1d89279f.js"><link rel="prefetch" href="/assets/js/178.0c76a326.js"><link rel="prefetch" href="/assets/js/179.1daae17e.js"><link rel="prefetch" href="/assets/js/18.b5aeb80c.js"><link rel="prefetch" href="/assets/js/180.7d4bcf23.js"><link rel="prefetch" href="/assets/js/181.e7e8943e.js"><link rel="prefetch" href="/assets/js/182.eb0bb581.js"><link rel="prefetch" href="/assets/js/183.e22f2ff8.js"><link rel="prefetch" href="/assets/js/184.0c3ee0ef.js"><link rel="prefetch" href="/assets/js/185.ac665590.js"><link rel="prefetch" href="/assets/js/186.ae753097.js"><link rel="prefetch" href="/assets/js/187.6bb3ea4f.js"><link rel="prefetch" href="/assets/js/188.40febd17.js"><link rel="prefetch" href="/assets/js/189.12990412.js"><link rel="prefetch" href="/assets/js/19.e7a5f211.js"><link rel="prefetch" href="/assets/js/190.eb958cd8.js"><link rel="prefetch" href="/assets/js/191.15bef9d1.js"><link rel="prefetch" href="/assets/js/192.a60a3ace.js"><link rel="prefetch" href="/assets/js/193.77817e63.js"><link rel="prefetch" href="/assets/js/194.5365953d.js"><link rel="prefetch" href="/assets/js/195.4458c727.js"><link rel="prefetch" href="/assets/js/196.fbd1aed4.js"><link rel="prefetch" href="/assets/js/197.9579017c.js"><link rel="prefetch" href="/assets/js/198.5a409f89.js"><link rel="prefetch" href="/assets/js/199.751fdeae.js"><link rel="prefetch" href="/assets/js/20.c924ef13.js"><link rel="prefetch" href="/assets/js/200.9520e90b.js"><link rel="prefetch" href="/assets/js/201.7dc338a6.js"><link rel="prefetch" href="/assets/js/202.e0acc37b.js"><link rel="prefetch" href="/assets/js/203.adcee730.js"><link rel="prefetch" href="/assets/js/204.61ca9761.js"><link rel="prefetch" href="/assets/js/205.046ff3c2.js"><link rel="prefetch" href="/assets/js/206.980a1e2f.js"><link rel="prefetch" href="/assets/js/207.bd935ebb.js"><link rel="prefetch" href="/assets/js/208.53462dda.js"><link rel="prefetch" href="/assets/js/209.26e8ed43.js"><link rel="prefetch" href="/assets/js/21.45873331.js"><link rel="prefetch" href="/assets/js/210.c96dd037.js"><link rel="prefetch" href="/assets/js/211.df45f48d.js"><link rel="prefetch" href="/assets/js/212.565c870c.js"><link rel="prefetch" href="/assets/js/213.861e52f6.js"><link rel="prefetch" href="/assets/js/214.3e0314f9.js"><link rel="prefetch" href="/assets/js/215.26dafef4.js"><link rel="prefetch" href="/assets/js/216.3d97b4bf.js"><link rel="prefetch" href="/assets/js/217.44b2535a.js"><link rel="prefetch" href="/assets/js/218.c148f03b.js"><link rel="prefetch" href="/assets/js/219.c9c056b0.js"><link rel="prefetch" href="/assets/js/22.eaa57ba3.js"><link rel="prefetch" href="/assets/js/220.7a69620d.js"><link rel="prefetch" href="/assets/js/221.444c4ed0.js"><link rel="prefetch" href="/assets/js/222.d297b457.js"><link rel="prefetch" href="/assets/js/223.de1dc4c1.js"><link rel="prefetch" href="/assets/js/224.ed5bf266.js"><link rel="prefetch" href="/assets/js/225.0c5501f3.js"><link rel="prefetch" href="/assets/js/226.296902cf.js"><link rel="prefetch" href="/assets/js/227.4845b698.js"><link rel="prefetch" href="/assets/js/228.360a44d1.js"><link rel="prefetch" href="/assets/js/229.3eb025ae.js"><link rel="prefetch" href="/assets/js/23.96b0b94a.js"><link rel="prefetch" href="/assets/js/230.c6a6906d.js"><link rel="prefetch" href="/assets/js/231.96559849.js"><link rel="prefetch" href="/assets/js/232.0a3e597d.js"><link rel="prefetch" href="/assets/js/233.0812d5dc.js"><link rel="prefetch" href="/assets/js/234.b524d070.js"><link rel="prefetch" href="/assets/js/235.dbe41016.js"><link rel="prefetch" href="/assets/js/236.0c9b7274.js"><link rel="prefetch" href="/assets/js/237.1c12ddcb.js"><link rel="prefetch" href="/assets/js/238.0182bff2.js"><link rel="prefetch" href="/assets/js/239.6bf32c60.js"><link rel="prefetch" href="/assets/js/24.f21a5952.js"><link rel="prefetch" href="/assets/js/240.d633453f.js"><link rel="prefetch" href="/assets/js/241.b67987cd.js"><link rel="prefetch" href="/assets/js/242.12b25557.js"><link rel="prefetch" href="/assets/js/243.64cd2657.js"><link rel="prefetch" href="/assets/js/244.41839b84.js"><link rel="prefetch" href="/assets/js/245.d3ea2b94.js"><link rel="prefetch" href="/assets/js/246.f28745bd.js"><link rel="prefetch" href="/assets/js/247.8b058ec0.js"><link rel="prefetch" href="/assets/js/248.ae0ccdc4.js"><link rel="prefetch" href="/assets/js/25.cf3b2672.js"><link rel="prefetch" href="/assets/js/26.bd75f33e.js"><link rel="prefetch" href="/assets/js/27.a50ccaa4.js"><link rel="prefetch" href="/assets/js/28.935954ff.js"><link rel="prefetch" href="/assets/js/29.1019d122.js"><link rel="prefetch" href="/assets/js/3.8b68acd9.js"><link rel="prefetch" href="/assets/js/30.1cc2bf18.js"><link rel="prefetch" href="/assets/js/31.4192f3e0.js"><link rel="prefetch" href="/assets/js/32.2878041a.js"><link rel="prefetch" href="/assets/js/33.df706b56.js"><link rel="prefetch" href="/assets/js/34.d4874ac2.js"><link rel="prefetch" href="/assets/js/35.a3236a31.js"><link rel="prefetch" href="/assets/js/36.f4d10b5d.js"><link rel="prefetch" href="/assets/js/37.6d6cf624.js"><link rel="prefetch" href="/assets/js/38.43f14233.js"><link rel="prefetch" href="/assets/js/39.787c3d00.js"><link rel="prefetch" href="/assets/js/4.a625b01b.js"><link rel="prefetch" href="/assets/js/40.cca17f94.js"><link rel="prefetch" href="/assets/js/41.93d8afce.js"><link rel="prefetch" href="/assets/js/42.a60ee9fc.js"><link rel="prefetch" href="/assets/js/43.412303fd.js"><link rel="prefetch" href="/assets/js/44.0912aa64.js"><link rel="prefetch" href="/assets/js/45.7846c200.js"><link rel="prefetch" href="/assets/js/46.ae8f2199.js"><link rel="prefetch" href="/assets/js/47.fec54085.js"><link rel="prefetch" href="/assets/js/48.12cf7b4d.js"><link rel="prefetch" href="/assets/js/49.c7421bd7.js"><link rel="prefetch" href="/assets/js/5.b5190b6e.js"><link rel="prefetch" href="/assets/js/50.1d754627.js"><link rel="prefetch" href="/assets/js/51.016cf465.js"><link rel="prefetch" href="/assets/js/52.bca36278.js"><link rel="prefetch" href="/assets/js/53.cce3588f.js"><link rel="prefetch" href="/assets/js/54.f7faff63.js"><link rel="prefetch" href="/assets/js/55.c79595a1.js"><link rel="prefetch" href="/assets/js/57.696a2ae5.js"><link rel="prefetch" href="/assets/js/58.3a341c2e.js"><link rel="prefetch" href="/assets/js/59.172805a3.js"><link rel="prefetch" href="/assets/js/6.ec0e66a3.js"><link rel="prefetch" href="/assets/js/60.54e7d1f2.js"><link rel="prefetch" href="/assets/js/61.11e40c89.js"><link rel="prefetch" href="/assets/js/62.eb6d2d5e.js"><link rel="prefetch" href="/assets/js/63.3d43a71f.js"><link rel="prefetch" href="/assets/js/64.c1ddbcb3.js"><link rel="prefetch" href="/assets/js/65.ccda16a0.js"><link rel="prefetch" href="/assets/js/66.cfa96f6f.js"><link rel="prefetch" href="/assets/js/67.bf094c35.js"><link rel="prefetch" href="/assets/js/68.676a4976.js"><link rel="prefetch" href="/assets/js/69.8d202842.js"><link rel="prefetch" href="/assets/js/7.9f42503b.js"><link rel="prefetch" href="/assets/js/70.d90f10fb.js"><link rel="prefetch" href="/assets/js/71.1912a8c4.js"><link rel="prefetch" href="/assets/js/72.15925bd4.js"><link rel="prefetch" href="/assets/js/73.946c6c89.js"><link rel="prefetch" href="/assets/js/74.099c09c0.js"><link rel="prefetch" href="/assets/js/75.68c58eb8.js"><link rel="prefetch" href="/assets/js/76.6fb1a639.js"><link rel="prefetch" href="/assets/js/77.f9b170ad.js"><link rel="prefetch" href="/assets/js/78.902a615e.js"><link rel="prefetch" href="/assets/js/79.c0cdb6bc.js"><link rel="prefetch" href="/assets/js/8.d5b8bca3.js"><link rel="prefetch" href="/assets/js/80.c6eda9fa.js"><link rel="prefetch" href="/assets/js/81.2e1a1c83.js"><link rel="prefetch" href="/assets/js/82.22227954.js"><link rel="prefetch" href="/assets/js/83.dea746f1.js"><link rel="prefetch" href="/assets/js/84.b1ddabac.js"><link rel="prefetch" href="/assets/js/85.d64ca7c5.js"><link rel="prefetch" href="/assets/js/86.7db459bc.js"><link rel="prefetch" href="/assets/js/87.74a8d850.js"><link rel="prefetch" href="/assets/js/88.9c498fbe.js"><link rel="prefetch" href="/assets/js/89.a07d7030.js"><link rel="prefetch" href="/assets/js/9.3cbbae6f.js"><link rel="prefetch" href="/assets/js/90.37f45684.js"><link rel="prefetch" href="/assets/js/91.5c94373e.js"><link rel="prefetch" href="/assets/js/92.dc5d2b47.js"><link rel="prefetch" href="/assets/js/93.35da5f65.js"><link rel="prefetch" href="/assets/js/94.f3f10018.js"><link rel="prefetch" href="/assets/js/95.b83db5da.js"><link rel="prefetch" href="/assets/js/96.0120edf9.js"><link rel="prefetch" href="/assets/js/97.930974d7.js"><link rel="prefetch" href="/assets/js/98.da673b8f.js"><link rel="prefetch" href="/assets/js/99.5ebc837c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1ce20086.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">wabicai的个人空间</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/基础知识/1.静态语言和非静态语言.html" class="nav-link">
  基础知识
</a></li><li class="dropdown-item"><!----> <a href="/前端/HTML、CSS/1.垂直居中和水平居中方法总结.html" class="nav-link">
  HTML、CSS
</a></li><li class="dropdown-item"><!----> <a href="/前端/JavaScript/1.闭包相关.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/前端/浏览器相关/1.渲染进程中的渲染机制.html" class="nav-link">
  浏览器相关
</a></li><li class="dropdown-item"><!----> <a href="/前端/前端工程化/1.Wepbpack:基本概念.html" class="nav-link">
  前端工程化｜模块化
</a></li><li class="dropdown-item"><!----> <a href="/前端/Vue/1.生命周期，钩子函数.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/前端/React/1.React Hook.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/前端/小程序/1.H5和小程序有什么区别.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/前端/原理实现/Vue-computed和watch.html" class="nav-link">
  原理实现
</a></li><li class="dropdown-item"><!----> <a href="/前端/场景题/1.大数据列表渲染的优化.html" class="nav-link">
  场景题
</a></li><li class="dropdown-item"><!----> <a href="/前端/前端Api实现、算法相关/1.Promise实现sleep.html" class="nav-link">
  前端Api实现、算法相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端/Golang/1.javascript与Golang中类型的异同.html" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/后端/Mysql/1.基础命令.html" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基石" class="dropdown-title"><span class="title">基石</span> <span class="arrow down"></span></button> <button type="button" aria-label="基石" class="mobile-dropdown-title"><span class="title">基石</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/基石/git、Linux、Vim相关操作/1.git.html" class="nav-link">
  git、Linux、Vim相关操作
</a></li><li class="dropdown-item"><!----> <a href="/基石/操作系统与数据库/1.进程和线程的区别.html" class="nav-link">
  操作系统与数据库
</a></li><li class="dropdown-item"><!----> <a href="/基石/计算机网络/1.OSI七层模型，各层协议.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/基石/设计模式/创建型-工厂模式.html" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作记录" class="dropdown-title"><span class="title">工作记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作记录" class="mobile-dropdown-title"><span class="title">工作记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/工作记录/H5前端/优化-使用IndexDB解决Svga重复加载问题.html" class="nav-link">
  H5前端
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/后端/基建-node服务治理.html" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/小程序/如何实现插件与小程序的通信.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/项目方案设计/1.electron xp适配.html" class="nav-link">
  项目方案设计
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/项目难点.html" class="nav-link">
  项目难点
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目简历" class="dropdown-title"><span class="title">项目简历</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目简历" class="mobile-dropdown-title"><span class="title">项目简历</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/resume.html" class="nav-link">
  wabicai
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/基础知识/1.静态语言和非静态语言.html" class="nav-link">
  基础知识
</a></li><li class="dropdown-item"><!----> <a href="/前端/HTML、CSS/1.垂直居中和水平居中方法总结.html" class="nav-link">
  HTML、CSS
</a></li><li class="dropdown-item"><!----> <a href="/前端/JavaScript/1.闭包相关.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/前端/浏览器相关/1.渲染进程中的渲染机制.html" class="nav-link">
  浏览器相关
</a></li><li class="dropdown-item"><!----> <a href="/前端/前端工程化/1.Wepbpack:基本概念.html" class="nav-link">
  前端工程化｜模块化
</a></li><li class="dropdown-item"><!----> <a href="/前端/Vue/1.生命周期，钩子函数.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/前端/React/1.React Hook.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/前端/小程序/1.H5和小程序有什么区别.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/前端/原理实现/Vue-computed和watch.html" class="nav-link">
  原理实现
</a></li><li class="dropdown-item"><!----> <a href="/前端/场景题/1.大数据列表渲染的优化.html" class="nav-link">
  场景题
</a></li><li class="dropdown-item"><!----> <a href="/前端/前端Api实现、算法相关/1.Promise实现sleep.html" class="nav-link">
  前端Api实现、算法相关
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/后端/Golang/1.javascript与Golang中类型的异同.html" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/后端/Mysql/1.基础命令.html" class="nav-link">
  Mysql
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基石" class="dropdown-title"><span class="title">基石</span> <span class="arrow down"></span></button> <button type="button" aria-label="基石" class="mobile-dropdown-title"><span class="title">基石</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/基石/git、Linux、Vim相关操作/1.git.html" class="nav-link">
  git、Linux、Vim相关操作
</a></li><li class="dropdown-item"><!----> <a href="/基石/操作系统与数据库/1.进程和线程的区别.html" class="nav-link">
  操作系统与数据库
</a></li><li class="dropdown-item"><!----> <a href="/基石/计算机网络/1.OSI七层模型，各层协议.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/基石/设计模式/创建型-工厂模式.html" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作记录" class="dropdown-title"><span class="title">工作记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作记录" class="mobile-dropdown-title"><span class="title">工作记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/工作记录/H5前端/优化-使用IndexDB解决Svga重复加载问题.html" class="nav-link">
  H5前端
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/后端/基建-node服务治理.html" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/小程序/如何实现插件与小程序的通信.html" class="nav-link">
  小程序
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/项目方案设计/1.electron xp适配.html" class="nav-link">
  项目方案设计
</a></li><li class="dropdown-item"><!----> <a href="/工作记录/项目难点.html" class="nav-link">
  项目难点
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目简历" class="dropdown-title"><span class="title">项目简历</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目简历" class="mobile-dropdown-title"><span class="title">项目简历</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/resume.html" class="nav-link">
  wabicai
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>javaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/前端/JavaScript/1.闭包相关.html" class="sidebar-link">1.闭包相关</a></li><li><a href="/前端/JavaScript/2.事件绑定、委托、阻止默认事件和阻止冒泡.html" class="sidebar-link">2.事件绑定、委托、阻止默认事件和阻止冒泡</a></li><li><a href="/前端/JavaScript/3.隐式类型转换.html" class="sidebar-link">3.隐式类型转换</a></li><li><a href="/前端/JavaScript/4.类型判断.html" class="sidebar-link">4.类型判断</a></li><li><a href="/前端/JavaScript/5.作用域链和原型链.html" class="sidebar-link">5.作用域链和原型链</a></li><li><a href="/前端/JavaScript/6.根据promiseA+实现一个自己的promise.html" class="sidebar-link">6.根据 promiseA+实现一个自己的 promise</a></li><li><a href="/前端/JavaScript/7.怎么理解 JS 边解释边执行？.html" class="sidebar-link">7.怎么理解 JS 边解释边执行？</a></li><li><a href="/前端/JavaScript/8.call、apply、bind的区别.html" class="sidebar-link">8.call、apply、bind 的区别</a></li><li><a href="/前端/JavaScript/9.DOM和BOM有什么关系.html" class="sidebar-link">9.DOM 和 BOM 有什么关系</a></li><li><a href="/前端/JavaScript/10.什么是类方法、对象方法、原型方法.html" class="sidebar-link">10.什么是类方法、对象方法、原型方法</a></li><li><a href="/前端/JavaScript/13.遍历数据的方法.html" class="sidebar-link">13.遍历数据的方法</a></li><li><a href="/前端/JavaScript/14.map、weakmap.html" class="sidebar-link">14.map、weakmap</a></li><li><a href="/前端/JavaScript/15.判读方法属性是否在原型链上.html" class="sidebar-link">15.判读方法属性是否在原型链上</a></li><li><a href="/前端/JavaScript/16.箭头函数.html" class="sidebar-link">16.箭头函数</a></li><li><a href="/前端/JavaScript/17.如何创建类.html" class="sidebar-link">17.如何创建类</a></li><li><a href="/前端/JavaScript/18.什么是Promise.html" class="sidebar-link">18.什么是 Promise</a></li><li><a href="/前端/JavaScript/19.async、await.html" class="sidebar-link">19.async、await</a></li><li><a href="/前端/JavaScript/20.this指向问题.html" class="sidebar-link">20.this 指向问题</a></li><li><a href="/前端/JavaScript/21.proxy和Object.defineProperty.html" class="sidebar-link">21.proxy 和 Object.defineProperty</a></li><li><a href="/前端/JavaScript/22.什么是yield.html" class="sidebar-link">22.什么是 yield</a></li><li><a href="/前端/JavaScript/23.Javascript安全规范.html" class="active sidebar-link">JavaScript代码安全规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/前端/JavaScript/23.Javascript安全规范.html#javascript页面类" class="sidebar-link">JavaScript页面类</a></li><li class="sidebar-sub-header"><a href="/前端/JavaScript/23.Javascript安全规范.html#node-js后台类" class="sidebar-link">Node.js后台类</a></li></ul></li><li><a href="/前端/JavaScript/24.Class in JS.html" class="sidebar-link">24.Class in JS</a></li><li><a href="/前端/JavaScript/25.setTimeout和setInterval.html" class="sidebar-link">25.setTimeout 和 setInterval</a></li><li><a href="/前端/JavaScript/26.MutationObserver.html" class="sidebar-link">26.MutationObserver</a></li><li><a href="/前端/JavaScript/27.requestAnimationFrame、requestIdleCallback、setTimeout.html" class="sidebar-link">27.requestAnimationFrame、requestIdleCallback、setTimeout</a></li><li><a href="/前端/JavaScript/28.let const var.html" class="sidebar-link">28.let const var</a></li><li><a href="/前端/JavaScript/Api用法记录.html" class="sidebar-link">Api 用法记录</a></li><li><a href="/前端/JavaScript/async、promise输出结果.html" class="sidebar-link">async、promise 输出结果</a></li><li><a href="/前端/JavaScript/this指向试题.html" class="sidebar-link">this 指向试题</a></li><li><a href="/前端/JavaScript/函数提升、变量提升试题.html" class="sidebar-link">函数提升、变量提升试题</a></li><li><a href="/前端/JavaScript/正则表达式.html" class="sidebar-link">正则表达式</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript代码安全规范"><a href="#javascript代码安全规范" class="header-anchor">#</a> JavaScript代码安全规范</h1> <p>[TOC]</p> <h2 id="javascript页面类"><a href="#javascript页面类" class="header-anchor">#</a> JavaScript页面类</h2> <h3 id="i-代码实现"><a href="#i-代码实现" class="header-anchor">#</a> I. 代码实现</h3> <h4 id="_1-1-原生dom-api的安全操作"><a href="#_1-1-原生dom-api的安全操作" class="header-anchor">#</a> 1.1 原生DOM API的安全操作</h4> <p><strong>1.1.1【必须】HTML标签操作，限定/过滤传入变量值</strong></p> <ul><li>使用<code>innerHTML=</code>、<code>outerHTML=</code>、<code>document.write()</code>、<code>document.writeln()</code>时，如变量值外部可控，应对特殊字符（<code>&amp;, &lt;, &gt;, &quot;, '</code>）做编码转义，或使用安全的DOM API替代，包括：<code>innerText=</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 假设 params 为用户输入， text 为 DOM 节点</span>
<span class="token comment">// bad：将不可信内容带入HTML标签操作</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
text<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Follow @</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// good: innerHTML操作前，对特殊字符编码转义</span>
<span class="token keyword">function</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span><span class="token parameter">iStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> sStr <span class="token operator">=</span> iStr<span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;lt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> sStr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
user <span class="token operator">=</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
text<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Follow @</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token comment">// good: 使用安全的DOM API替代innerHTML</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
text<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Follow @</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>1.1.2【必须】HTML属性操作，限定/过滤传入变量值</strong></p> <ul><li><p>使用<code>element.setAttribute(name, value);</code>时，如第一个参数值<code>name</code>外部可控，应用白名单限定允许操作的属性范围。</p></li> <li><p>使用<code>element.setAttribute(name, value);</code>时，操作<code>a.href</code>、<code>ifame.src</code>、<code>form.action</code>、<code>embed.src</code>、<code>object.data</code>、<code>link.href</code>、<code>area.href</code>、<code>input.formaction</code>、<code>button.formaction</code>属性时，如第二个参数值<code>value</code>外部可控，应参考<em>JavaScript页面类规范1.3.1</em>部分，限定页面重定向或引入资源的目标地址。</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// good: setAttribute操作前，限定引入资源的目标地址</span>
<span class="token keyword">function</span> <span class="token function">addExternalCss</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> t <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	t<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
	t<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'rel'</span><span class="token punctuation">,</span> <span class="token string">'stylesheet'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	t<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'text/css'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">validURL</span><span class="token punctuation">(</span><span class="token parameter">sUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(https?:\/\/)?[\w\-.]+\.(qq|tencent)\.com($|\/|\\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[\w][\w/.\-_%]+$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[/\\][^/\\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> sUrl <span class="token operator">=</span> <span class="token string">&quot;https://evil.com/1.css&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validURL</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">addExternalCss</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_1-2-流行框架-库的安全操作"><a href="#_1-2-流行框架-库的安全操作" class="header-anchor">#</a> 1.2 流行框架/库的安全操作</h4> <p><strong>1.2.1【必须】限定/过滤传入jQuery不安全函数的变量值</strong></p> <ul><li>使用<code>.html()</code>、<code>.append()</code>、<code>.prepend()</code>、<code>.wrap()</code>、<code>.replaceWith()</code>、<code>.wrapAll()</code>、<code>.wrapInner()</code>、<code>.after()</code>、<code>.before()</code>时，如变量值外部可控，应对特殊字符（<code>&amp;, &lt;, &gt;, &quot;, '</code>）做编码转义。</li> <li>引入<code>jQuery 1.x（等于或低于1.12）、jQuery2.x（等于或低于2.2）</code>，且使用<code>$()</code>时，应优先考虑替换为最新版本。如一定需要使用，应对传入参数值中的特殊字符（<code>&amp;, &lt;, &gt;, &quot;, '</code>）做编码转义。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad：将不可信内容，带入jQuery不安全函数.after()操作</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good: jQuery不安全函数.html()操作前，对特殊字符编码转义</span>
<span class="token keyword">function</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span><span class="token parameter">iStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> sStr <span class="token operator">=</span> iStr<span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;lt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&quot;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	sStr <span class="token operator">=</span> sStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&amp;#39;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> sStr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// let user = params.user;</span>
user <span class="token operator">=</span> <span class="token function">htmlEncode</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li><p>使用<code>.attr()</code>操作<code>a.href</code>、<code>ifame.src</code>、<code>form.action</code>、<code>embed.src</code>、<code>object.data</code>、<code>link.href</code>、<code>area.href</code>、<code>input.formaction</code>、<code>button.formaction</code>属性时，应参考<em>JavaScript页面类规范1.3.1</em>部分，限定重定向的资源目标地址。</p></li> <li><p>使用<code>.attr(attributeName, value)</code>时，如第一个参数值<code>attributeName</code>外部可控，应用白名单限定允许操作的属性范围。</p></li> <li><p>使用<code>$.getScript(url [, success ])</code>时，如第一个参数值<code>url</code>外部可控（如：从URL取值拼接，请求jsonp接口），应限定可控变量值的字符集范围为：<code>[a-zA-Z0-9_-]+</code>。</p></li></ul> <p><strong>1.2.2【必须】限定/过滤传入Vue.js不安全函数的变量值</strong></p> <ul><li>使用<code>v-html</code>时，不允许对用户提供的内容使用HTML插值。如业务需要，应先对不可信内容做富文本过滤。参考：<a href="https://git.code.oa.com/slugteam/v-xss-html" target="_blank" rel="noopener noreferrer">vue-xssFilter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// bad：直接渲染外部传入的不可信内容
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userProvidedHtml<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

// good：使用富文本过滤库处理不可信内容后渲染
<span class="token comment">&lt;!-- 使用 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-xss-html</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{'mode': 'whitelist', dirty: html, options: options}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 配置 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
	<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">whiteList</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;target&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token literal-property property">div</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token literal-property property">span</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token literal-property property">img</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alt&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li><p>使用<code>v-bind</code>操作<code>a.href</code>、<code>ifame.src</code>、<code>form.action</code>、<code>embed.src</code>、<code>object.data</code>、<code>link.href</code>、<code>area.href</code>、<code>input.formaction</code>、<code>button.formaction</code>时，应确保后端已参考<em>JavaScript页面类规范1.3.1</em>部分，限定了供前端调用的重定向目标地址。</p></li> <li><p>使用<code>v-bind</code>操作<code>style</code>属性时，应只允许外部控制特定、可控的CSS属性值</p></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// bad：v-bind允许外部可控值，自定义CSS属性及数值
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sanitizedUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userProvidedStyles<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
click me
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

// good：v-bind只允许外部提供特性、可控的CSS属性值
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name"><span class="token namespace">v-bind:</span>href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sanitizedUrl<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">v-bind:</span>style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
color: userProvidedColor,
background: userProvidedBackground
}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
click me
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_1-3-页面重定向"><a href="#_1-3-页面重定向" class="header-anchor">#</a> 1.3 页面重定向</h4> <p><strong>1.3.1【必须】限定跳转目标地址</strong></p> <ul><li><p>使用白名单，限定重定向地址的协议前缀（默认只允许HTTP、HTTPS）、域名（默认只允许公司根域），或指定为固定值；</p></li> <li><p>适用场景包括，使用函数方法：<code>location.href</code>、<code>window.open()</code>、<code>location.assign()</code>、<code>location.replace()</code>；赋值或更新HTML属性：<code>a.href</code>、<code>ifame.src</code>、<code>form.action</code>、<code>embed.src</code>、<code>object.data</code>、<code>link.href</code>、<code>area.href</code>、<code>input.formaction</code>、<code>button.formaction</code>；</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad: 跳转至外部可控的不可信地址</span>
<span class="token keyword">const</span> sTargetUrl <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sTargetUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good: 白名单限定重定向地址</span>
<span class="token keyword">function</span> <span class="token function">validURL</span><span class="token punctuation">(</span><span class="token parameter">sUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(https?:\/\/)?[\w\-.]+\.(qq|tencent)\.com($|\/|\\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[\w][\w/.\-_%]+$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[/\\][^/\\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> sTargetUrl <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">&quot;target&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">validURL</span><span class="token punctuation">(</span>sTargetUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sTargetUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// good: 制定重定向地址为固定值</span>
<span class="token keyword">const</span> sTargetUrl <span class="token operator">=</span> <span class="token string">&quot;http://www.qq.com&quot;</span><span class="token punctuation">;</span>
location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>sTargetUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_1-4-json解析-动态执行"><a href="#_1-4-json解析-动态执行" class="header-anchor">#</a> 1.4 JSON解析/动态执行</h4> <p><strong>1.4.1【必须】使用安全的JSON解析方式</strong></p> <ul><li>应使用<code>JSON.parse()</code>解析JSON字符串。低版本浏览器，应使用安全的<a href="https://github.com/douglascrockford/JSON-js/blob/master/json2.js" target="_blank" rel="noopener noreferrer">Polyfill封装<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad: 直接调用eval解析json</span>
<span class="token keyword">const</span> sUserInput <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">&quot;json_val&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jsonstr1 <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{&quot;name&quot;:&quot;a&quot;,&quot;company&quot;:&quot;b&quot;,&quot;value&quot;:&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sUserInput<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> json1 <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>jsonstr1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good: 使用JSON.parse解析</span>
<span class="token keyword">const</span> sUserInput <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">&quot;json_val&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sUserInput<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token keyword">return</span> v<span class="token punctuation">;</span>
	<span class="token keyword">return</span> v <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good: 低版本浏览器，使用安全的Polyfill封装（基于eval）</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;https://github.com/douglascrockford/JSON-js/blob/master/json2.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sUserInput <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">&quot;json_val&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>sUserInput<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_1-5-跨域通讯"><a href="#_1-5-跨域通讯" class="header-anchor">#</a> 1.5 跨域通讯</h4> <p><strong>1.5.1【必须】使用安全的前端跨域通信方式</strong></p> <ul><li>具有隔离登录态（如：p_skey）、涉及用户高敏感信息的业务（如：微信网页版、QQ空间、QQ邮箱、公众平台），禁止通过<code>document.domain</code>降域，实现前端跨域通讯，应使用postMessage替代。</li></ul> <p><strong>1.5.2【必须】使用postMessage应限定Origin</strong></p> <ul><li><p>在message事件监听回调中，应先使用<code>event.origin</code>校验来源，再执行具体操作。</p></li> <li><p>校验来源时，应使用<code>===</code>判断，禁止使用<code>indexOf()</code></p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad: 使用indexOf校验Origin值</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span>e<span class="token punctuation">.</span>origin<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;https://a.qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good: 使用postMessage时，限定Origin，且使用===判断</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>origin <span class="token operator">===</span> <span class="token string">&quot;https://a.qq.com&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="ii-配置-环境"><a href="#ii-配置-环境" class="header-anchor">#</a> II. 配置&amp;环境</h3> <h4 id="_2-1-敏感-配置信息"><a href="#_2-1-敏感-配置信息" class="header-anchor">#</a> 2.1 敏感/配置信息</h4> <p><strong>2.1.1【必须】禁止明文硬编码AK/SK</strong></p> <ul><li>禁止前端页面的JS明文硬编码AK/SK类密钥，应封装成后台接口，AK/SK保存在后端配置中心或密钥管理系统
<img src="https://git.code.oa.com/yuyangzhou/standards/uploads/F94EC9EEAC7C4CB2BB66B99C72736203/ak-sk.png" alt="ak-sk.png"></li></ul> <h4 id="_2-2-第三方组件-资源"><a href="#_2-2-第三方组件-资源" class="header-anchor">#</a> 2.2 第三方组件/资源</h4> <p><strong>2.2.1【必须】使用可信范围内的统计组件</strong></p> <ul><li>站点统计分析，应优先选用腾讯内部组件。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>前端监控TAM https://tam.woa.com/
腾讯分析 https://mta.qq.com/
Google统计 https://analytics.google.com/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>2.2.2 【必须】禁止引入非可信来源的第三方JS</strong></p> <ul><li>应检查页面内引入第三方JS资源是否可控。判断标准如下：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>1) 已在GLSB（ http://gslb.oa.com/ ）报备、属于公司资产的域名
2) 腾讯云相关、且注册账号归属公司自研范围的域名、IP
3) 可信外部公司、合作伙伴的站点
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_2-3-纵深安全防护"><a href="#_2-3-纵深安全防护" class="header-anchor">#</a> 2.3 纵深安全防护</h4> <p><strong>2.3.1【推荐】部署CSP，并启用严格模式</strong></p> <ul><li>按<a href="http://km.oa.com/articles/view/339833" target="_blank" rel="noopener noreferrer">《腾讯内容安全防护策略（CSP）部署规范》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>部署CSP，规则中应引入最新的严格模式特性<code>nonce-</code></li></ul> <h2 id="node-js后台类"><a href="#node-js后台类" class="header-anchor">#</a> Node.js后台类</h2> <h3 id="i-代码实现-2"><a href="#i-代码实现-2" class="header-anchor">#</a> I. 代码实现</h3> <h4 id="_1-1-输入验证"><a href="#_1-1-输入验证" class="header-anchor">#</a> 1.1 输入验证</h4> <p><strong>1.1.1【必须】按类型进行数据校验</strong></p> <ul><li>所有程序外部输入的参数值，应进行数据校验。校验内容包括但不限于：数据长度、数据范围、数据类型与格式。校验不通过，应拒绝。</li> <li>推荐使用组件：<a href="https://www.npmjs.com/package/validator" target="_blank" rel="noopener noreferrer">validator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad：未进行输入验证</span>
Router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/vulxss&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> txt <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;text/html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">data</span><span class="token operator">:</span> txt<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good：按数据类型，进行输入验证</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;validator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/email_with_validator&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> txt <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>txt <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>validator<span class="token punctuation">.</span><span class="token function">isEmail</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">data</span><span class="token operator">:</span> txt<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><em>关联漏洞：纵深防护措施 - 安全性增强特性</em></p> <h4 id="_1-2-执行命令"><a href="#_1-2-执行命令" class="header-anchor">#</a> 1.2 执行命令</h4> <p><strong>1.2.1 【必须】使用child_process执行系统命令，应限定或校验命令和参数的内容</strong></p> <ul><li><p>适用场景包括：<code>child_process.exec</code>, <code>child_process.execSync</code>, <code>child_process.spawn</code>, <code>child_process.spawnSync</code>, <code>child_process.execFile</code>, <code>child_process.execFileSync</code></p></li> <li><p>调用上述函数，应首先考虑限定范围，供用户选择。</p></li> <li><p>使用<code>child_process.exec</code>或<code>child_process.execSync</code>时，如果可枚举输入的参数内容或者格式，则应限定白名单。如果无法枚举命令或参数，则必须过滤或者转义指定符号，包括：<code>|;&amp;$()&gt;&lt;`!</code></p></li> <li><p>使用<code>child_process.spawn</code> 或<code>child_process.execFile</code>时，应校验传入的命令和参数在可控列表内。</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;validator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// bad：未限定或过滤，直接执行命令</span>
Router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/vul_cmd_inject&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> txt <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>txt <span class="token operator">||</span> <span class="token string">&quot;echo 1&quot;</span><span class="token punctuation">;</span>
	<span class="token function">exec</span><span class="token punctuation">(</span>txt<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>stdout<span class="token punctuation">,</span> stderr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good：通过白名单，限定外部可执行命令范围</span>
Router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/not_vul_cmd_inject&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> txt <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>txt <span class="token operator">||</span> <span class="token string">&quot;echo 1&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> phone <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>phone <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> cmdList <span class="token operator">=</span> <span class="token punctuation">{</span>
    	<span class="token literal-property property">sendmsg</span><span class="token operator">:</span> <span class="token string">&quot;./sendmsg &quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>txt <span class="token keyword">in</span> cmdList <span class="token operator">&amp;&amp;</span> validator<span class="token punctuation">.</span><span class="token function">isMobilePhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">exec</span><span class="token punctuation">(</span>cmdList<span class="token punctuation">[</span>txt<span class="token punctuation">]</span> <span class="token operator">+</span> phone<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
          res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>stdout<span class="token punctuation">,</span> stderr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
			<span class="token literal-property property">tips</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">you can use '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>cmdList<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good：执行命令前，过滤/转义指定符号</span>
Router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/not_vul_cmd_inject&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> txt <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>txt <span class="token operator">||</span> <span class="token string">&quot;echo 1&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> phone <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>phone <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> cmdList <span class="token operator">=</span> <span class="token punctuation">{</span>
    	<span class="token literal-property property">sendmsg</span><span class="token operator">:</span> <span class="token string">&quot;./sendmsg &quot;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	phone <span class="token operator">=</span> phone<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\||;|&amp;|\$\(|\(|\)|&gt;|&lt;|`|!)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>txt <span class="token keyword">in</span> cmdList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">exec</span><span class="token punctuation">(</span>cmdList<span class="token punctuation">[</span>txt<span class="token punctuation">]</span> <span class="token operator">+</span> phone<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
          res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>stdout<span class="token punctuation">,</span> stderr<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">err</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
			<span class="token literal-property property">tips</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">you can use '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>cmdList<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p><em>关联漏洞：高风险 - 任意命令执行</em></p> <h4 id="_1-3-文件操作"><a href="#_1-3-文件操作" class="header-anchor">#</a> 1.3 文件操作</h4> <p><strong>1.3.1 【必须】限定文件操作的后缀范围</strong></p> <ul><li>按业务需求，使用白名单限定后缀范围。</li></ul> <p><strong>1.3.2 【必须】校验并限定文件路径范围</strong></p> <ul><li>应尽量固定上传、访问文件的路径，避免将外部可控的参数值拼入。</li> <li>使用<code>fs</code>模块下的函数方法时，应对第一个参数即路径部分做校验，检查是否包含路径穿越字符<code>.</code>或<code>..</code>。涉及方法包括但不限于：<code>fs.truncate</code>、<code>fs.truncateSync</code>、<code>fs.chown</code>、<code>fs.chownSync</code>、<code>fs.lchown</code>、<code>fs.lchownSync</code>、<code>fs.stat</code>、<code>fs.lchmodSync</code>、<code>fs.lstat</code>、<code>fs.statSync</code>、<code>fs.lstatSync</code>、<code>fs.readlink</code>、<code>fs.unlink</code>、<code>fs.unlinkSync</code>、<code>fs.rmdir</code>、<code>fs.rmdirSync</code>、<code>fs.mkdir</code>、<code>fs.mkdirSync</code>、<code>fs.readdir</code>、<code>fs.readdirSync</code>、<code>fs.openSync</code>、<code>fs.open</code>、<code>fs.createReadStream</code>、<code>fs.createWriteStream</code></li> <li>使用express框架的<code>sendFile</code>方法时，应对第一个参数即路径部分做校验，检查是否包含路径穿越字符<code>.</code>或<code>..</code></li> <li>校验时，应使用<code>path</code>模块处理前的路径参数值，或判断处理过后的路径是否穿越出了当前工作目录。涉及方法包括但不限于：<code>path.resolve</code>、<code>path.join</code>、<code>path.normalize</code>等</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> filename <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>ufile<span class="token punctuation">;</span>
<span class="token keyword">let</span> root <span class="token operator">=</span> <span class="token string">'/data/ufile'</span><span class="token punctuation">;</span>

<span class="token comment">// bad：未检查文件名/路径</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>root <span class="token operator">+</span> filename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">异步读取: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// bad：使用path处理过后的路径参数值做校验，仍可能有路径穿越风险</span>
filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// good：检查了文件名/路径，是否包含路径穿越字符</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;..&quot;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	filename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
	fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>1.3.3 【必须】安全地处理上传文件名</strong></p> <ul><li>将上传文件重命名为16位以上的随机字符串保存。</li> <li>如需原样保留文件名，应检查是否包含<code>..</code>、<code>.</code>路径穿越字符。如存在，应拒绝。</li></ul> <p><strong>1.3.4 【必须】敏感资源文件，应有加密、鉴权和水印等加固措施</strong></p> <ul><li>用户上传的<code>身份证</code>、<code>银行卡</code>等图片，属敏感资源文件，应采取安全加固。</li> <li>指向此类文件的URL，应保证不可预测性；同时，确保无接口会批量展示此类资源的URL。</li> <li>访问敏感资源文件时，应进行权限控制。默认情况下，仅用户可查看、操作自身敏感资源文件。</li> <li>图片类文件应添加业务水印，表明该图片仅可用于当前业务使用。</li></ul> <h4 id="_1-4-网络请求"><a href="#_1-4-网络请求" class="header-anchor">#</a> 1.4 网络请求</h4> <p><strong>1.4.1 【必须】限定访问网络资源地址范围</strong></p> <ul><li><p>应固定程序访问网络资源地址的<code>协议</code>、<code>域名</code>、<code>路径</code>范围。</p></li> <li><p>若业务需要，外部可指定访问网络资源地址，应禁止访问内网私有地址段及域名。范围如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">8</span>
<span class="token number">172.16</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">12</span>
<span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">16</span>
<span class="token number">100.64</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">10</span>
<span class="token number">9.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">8</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">8</span>
<span class="token number">11.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">8</span>
<span class="token number">30.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <p><strong>1.4.2 【推荐】请求网络资源，应加密传输</strong></p> <ul><li>应优先选用https协议请求网络资源</li></ul> <p><em>关联漏洞：高风险 - SSRF，高风险 - HTTP劫持</em></p> <h4 id="_1-5-数据输出"><a href="#_1-5-数据输出" class="header-anchor">#</a> 1.5 数据输出</h4> <p><strong>1.5.1 【必须】高敏感信息禁止存储、展示</strong></p> <ul><li>口令、密保答案、生理标识等鉴权信息禁止展示</li> <li>非金融类业务，信用卡cvv码及日志禁止存储</li></ul> <p><strong>1.5.2【必须】一般敏感信息脱敏展示</strong></p> <ul><li>身份证只显示第一位和最后一位字符，如：<code>3*********************1</code></li> <li>移动电话号码隐藏中间6位字符，如：<code>134***************48</code></li> <li>工作地址/家庭地址最多显示到<code>区</code>一级</li> <li>银行卡号仅显示最后4位字符，如：<code>*********************8639</code></li></ul> <p><strong>1.5.3 【推荐】返回的字段按业务需要输出</strong></p> <ul><li>按需输出，避免不必要的用户信息泄露</li> <li>用户敏感数据应在服务器后台处理后输出，不可以先输出到客户端，再通过客户端代码来处理展示</li></ul> <p><em>关联漏洞：高风险 - 用户敏感信息泄露</em></p> <h4 id="_1-6-响应输出"><a href="#_1-6-响应输出" class="header-anchor">#</a> 1.6 响应输出</h4> <p><strong>1.6.1 【必须】设置正确的HTTP响应包类型</strong></p> <ul><li>响应头Content-Type与实际响应内容，应保持一致。如：API响应数据类型是json，则响应头使用<code>application/json</code>；若为xml，则设置为<code>text/xml</code>。</li></ul> <p><strong>1.6.2 【必须】添加安全响应头</strong></p> <ul><li>所有接口、页面，添加响应头 <code>X-Content-Type-Options: nosniff</code>。</li> <li>所有接口、页面，添加响应头<code>X-Frame-Options</code>。按需合理设置其允许范围，包括：<code>DENY</code>、<code>SAMEORIGIN</code>、<code>ALLOW-FROM origin</code>。用法参考：<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options" target="_blank" rel="noopener noreferrer">MDN文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>推荐使用组件： <a href="https://www.npmjs.com/package/helmet" target="_blank" rel="noopener noreferrer">helmet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><strong>1.6.3 【必须】外部输入拼接到响应页面前，进行编码处理</strong></p> <table><thead><tr><th>场景</th> <th>编码规则</th></tr></thead> <tbody><tr><td>输出点在HTML标签之间</td> <td>需要对以下6个特殊字符进行HTML实体编码(&amp;, &lt;, &gt;, &quot;, ',/)。<br>示例：<br>&amp; --&gt; &amp;amp;<br>&lt; --&gt; &amp;lt;<br>&gt;--&gt; &amp;gt;<br>&quot; --&gt; &amp;quot;<br>' --&gt; &amp;#x27;  <br>/ --&gt; &amp;#x2F;</td></tr> <tr><td>输出点在HTML标签普通属性内（如href、src、style等，on事件除外）</td> <td>要对数据进行HTML属性编码。<br>编码规则：除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的ASCII码小于256。编码后输出的格式为&amp;#xHH;(以&amp;#x开头，HH则是指该字符对应的十六进制数字，分号作为结束符)</td></tr> <tr><td>输出点在JS内的数据中</td> <td>需要进行js编码<br>编码规则：<br>除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的ASCII码小于256。编码后输出的格式为 \xHH （以 \x 开头，HH则是指该字符对应的十六进制数字）<br>Tips：这种场景仅限于外部数据拼接在js里被引号括起来的变量值中。除此之外禁止直接将代码拼接在js代码中。</td></tr> <tr><td>输出点在CSS中（Style属性）</td> <td>需要进行CSS编码<br>编码规则：<br>除了阿拉伯数字和字母，对其他所有的字符进行编码，只要该字符的ASCII码小于256。编码后输出的格式为 \HH （以 \ 开头，HH则是指该字符对应的十六进制数字）</td></tr> <tr><td>输出点在URL属性中</td> <td>对这些数据进行URL编码<br>Tips：除此之外，所有链接类属性应该校验其协议。禁止JavaScript、data和Vb伪协议。</td></tr></tbody></table> <p><strong>1.6.4 【必须】响应禁止展示物理资源、程序内部代码逻辑等敏感信息</strong></p> <ul><li>业务生产（正式）环境，应用异常时，响应内容禁止展示敏感信息。包括但不限于：<code>物理路径</code>、<code>程序内部源代码</code>、<code>调试日志</code>、<code>内部账号名</code>、<code>内网ip地址</code>等。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>// bad
Access denied for user 'xxx'@'9.xxx.xxx.162' (using password: NO)&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>1.6.5 【推荐】添加安全纵深防御措施</strong></p> <ul><li>按<a href="http://km.oa.com/articles/view/339833" target="_blank" rel="noopener noreferrer">《腾讯内容安全防护策略（CSP）部署规范》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>部署CSP，规则中应引入最新的严格模式特性<code>nonce-</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// good：使用helmet组件安全地配置响应头</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> helmet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;helmet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good：正确配置Content-Type、添加了安全响应头，引入了CSP</span>
Router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-Content-Type-Options&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nosniff&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-Frame-Options&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SAMEORIGIN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Security-Policy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;script-src 'self'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><em>关联漏洞：中风险 - XSS、中风险 - 跳转漏洞</em></p> <h4 id="_1-7-执行代码"><a href="#_1-7-执行代码" class="header-anchor">#</a> 1.7 执行代码</h4> <p><strong>1.7.1 【必须】安全的代码执行方式</strong></p> <ul><li>禁止使用 <code>eval</code> 函数</li> <li>禁止使用<code>new Function(&quot;input&quot;)()</code> 来创建函数</li> <li>使用 <code>setInteval</code>，<code>setTimeout</code>，应校验传入的参数</li></ul> <p><em>关联漏洞：高风险 - 代码执行漏洞</em></p> <h4 id="_1-8-web跨域"><a href="#_1-8-web跨域" class="header-anchor">#</a> 1.8 Web跨域</h4> <p><strong>1.8.1 【必须】限定JSONP接口的callback字符集范围</strong></p> <ul><li>JSONP接口的callback函数名为固定白名单。如callback函数名可用户自定义，应限制函数名仅包含 字母、数字和下划线。如：<code>[a-zA-Z0-9_-]+</code></li></ul> <p><strong>1.8.2 【必须】安全的CORS配置</strong></p> <ul><li>使用CORS，应对请求头Origin值做严格过滤、校验。具体来说，可以使用“全等于”判断，或使用严格的正则进行判断。如：<code>^https://domain\.qq\.com$</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// good：使用全等于，校验请求的Origin</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin <span class="token operator">===</span> <span class="token string">'https://domain.qq.com'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Credentials'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><em>关联漏洞：中风险 - XSS，中风险 - CSRF，中风险 - CORS配置不当</em></p> <h4 id="_1-9-sql操作"><a href="#_1-9-sql操作" class="header-anchor">#</a> 1.9 SQL操作</h4> <p><strong>1.9.1 【必须】SQL语句默认使用预编译并绑定变量</strong></p> <ul><li><p>应使用预编译绑定变量的形式编写sql语句，保持查询语句和数据相分离</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad：拼接SQL语句查询，存在安全风险</span>
<span class="token keyword">const</span> mysql  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sql <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * from some_table WHERE Id = %s and Name = %s&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle err..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment">// good：使用预编译绑定变量构造SQL语句</span>
<span class="token keyword">const</span> mysql  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token string">&quot;SELECT * from some_table WHERE Id = ? and Name = ?&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sqlParams <span class="token operator">=</span> <span class="token punctuation">[</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>id<span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> sqlParams<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle err..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li> <li><p>对于表名、列名等无法进行预编译的场景，如：<code>__user_input__</code> 拼接到比如 <code>limit</code>, <code>order by</code>, <code>group by</code> , <code>from tablename</code>语句中。请使用以下方法：</p> <p><em>方案1：使用白名单校验表名/列名</em></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// good</span>
<span class="token keyword">const</span> tableSuffix <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;expected1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;expected2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>tableSuffix<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 不在表名白名单中，拒绝请求</span>
	<span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * from t_business_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tableSuffix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle err..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><em>方案2：使用反引号包裹表名/列名，并过滤 <code>__user_input__</code> 中的反引号</em></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// good</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> orderType <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token comment">// 过滤掉__user_input__中的反引号</span>
orderType <span class="token operator">=</span> orderType<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;`&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sql <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * from t_business_feeds order by `%s`&quot;</span><span class="token punctuation">,</span> orderType<span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle err..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><em>方案3：将 <code>__user_input__</code> 转换为整数</em></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// good</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> orderType <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token comment">// 强制转换为整数</span>
orderType <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>orderType<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">SELECT * from t_business_feeds order by </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>orderType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle err..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <p><strong>1.9.2 【必须】安全的ORM操作</strong></p> <ul><li><p>使用安全的ORM组件进行数据库操作。如 <code>sequelize</code> 等</p></li> <li><p>禁止<code>__user_input__</code>以拼接的方式直接传入ORM的各类raw方法</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//bad: adonisjs ORM</span>
<span class="token comment">//参考：https://adonisjs.com/docs/3.2/security-introduction#_sql_injection</span>
<span class="token keyword">const</span> username <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">yield</span> Database
  <span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>Database<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">username = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//good: adonisjs ORM</span>
<span class="token keyword">const</span> username <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">yield</span> Database
  <span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>Database<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token string">&quot;username = ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>使用ORM进行Update/Insert操作时，应限制操作字段范围</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/*
good
假设该api用于插入用户的基本信息，使用传入的req.body通过Sequelize的create方法实现
假设User包含字段：username,email,isAdmin，
其中,isAdmin将会用于是否系统管理员的鉴权，默认值为false
*/</span>
<span class="token comment">// Sequelize: 只允许变更username、email字段值</span>
User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// handle the rest..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p><strong>为什么要这么做？</strong>
在上述案例中，若不限定fields值，攻击者将可传入<code>{&quot;username&quot;:&quot;boo&quot;,&quot;email&quot;:&quot;foo@boo.com&quot;,&quot;isAdmin&quot;:true}</code>将自己变为<code>Admin</code>，产生垂直越权漏洞。</p></blockquote> <p><em>关联漏洞：高风险 - SQL注入，中风险 - Mass Assignment 逻辑漏洞</em></p> <h4 id="_1-10-nosql操作"><a href="#_1-10-nosql操作" class="header-anchor">#</a> 1.10 NoSQL操作</h4> <p><strong>1.10.1 【必须】校验参数值类型</strong></p> <ul><li>将HTTP参数值代入NoSQL操作前，应校验类型。如非功能需要，禁止对象（Object）类型传入。</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad：执行NOSQL操作前，未作任何判断</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> users</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// **TODO:** handle the rest</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good：在进入nosql前先判断`__USER_INPUT__`是否为字符串。</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;username must be a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token operator">!==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;password must be a string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">username</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> users</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// **TODO:** handle the rest</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p><strong>为什么要这么做？</strong></p> <p>JavaScript中，从http或socket接收的数据可能不是单纯的字符串，而是被黑客精心构造的对象(Object)。在本例中：</p> <ul><li>期望接收的POST数据：<code>username=foo&amp;password=bar</code></li> <li>期望的等价条件查询sql语句：<code>select * from users where username = 'foo' and password = 'bar'</code></li> <li>黑客的精心构造的攻击POST数据：<code>username[$ne]=null&amp;password[$ne]=null</code>或JSON格式：<code>{&quot;username&quot;: {&quot;$ne&quot;: null},&quot;password&quot;: {&quot;$ne&quot;: null}}</code></li> <li>黑客篡改后的等价条件查询sql语句：<code>select * from users where username != null &amp; password != null</code></li> <li>黑客攻击结果：绕过正常逻辑，在不知道他人的username/password的情况登录他人账号。</li></ul></blockquote> <p><strong>1.10.2 【必须】NoSQL操作前，应校验权限/角色</strong></p> <ul><li>执行NoSQL增、删、改、查逻辑前，应校验权限</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 使用express、mongodb(mongoose)实现的删除文章demo</span>
<span class="token comment">// bad：在删除文章前未做权限校验</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/deleteArticle&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">.</span>articles<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">article_id</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>article_id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> users</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO: handle the rest</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good：进入nosql语句前先进行权限校验</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/deleteArticle&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">checkPriviledge</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>uin<span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>article_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	db<span class="token punctuation">.</span>articles<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">article_id</span><span class="token operator">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>article_id <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> users</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// TODO: handle the rest</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><em>关联漏洞：高风险 - 越权操作，高风险 - NoSQL注入</em></p> <h4 id="_1-11-服务器端渲染-ssr"><a href="#_1-11-服务器端渲染-ssr" class="header-anchor">#</a> 1.11 服务器端渲染（SSR）</h4> <p><strong>1.11.1 【必须】安全的Vue服务器端渲染(Vue SSR)</strong></p> <ul><li><p>禁止直接将不受信的外部内容传入<code></code>表达式中</p></li> <li><p>模板内容禁止被污染</p></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad: 将用户输入替换进模板</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">template</span><span class="token operator">:</span> appTemplate<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;word&quot;</span><span class="token punctuation">,</span> __USER_INPUT__<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>对已渲染的HTML文本内容（renderToString后的html内容）。如需再拼不受信的外部输入，应先进行安全过滤，具体请参考<strong>1.6.3</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad: 渲染后的html再拼接不受信的外部输入</span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	renderer<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span>component<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> htmlOutput <span class="token operator">=</span> html<span class="token punctuation">;</span>
		htmlOutput <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__USER_INPUT__<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
		<span class="token function">resolve</span><span class="token punctuation">(</span>htmlOutput<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>1.11.2 【必须】安全地使用EJS、LoDash、UnderScore进行服务器端渲染</strong></p> <ul><li><p>使用render函数时，模板内容禁止被污染</p> <p>lodash.Template:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// bad: 将用户输入送进模板</span>
<span class="token keyword">const</span> compiled <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">template</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;b&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__USER_INPUT__<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;%- value %&gt;&lt;/b&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">compiled</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ejs:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// bad: 将用户输入送进模板</span>
<span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ejs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;geddy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;neil&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;alex&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> html <span class="token operator">=</span> ejs<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;%= people.join(&quot;, &quot;); %&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__USER_INPUT__<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span> people <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Ejs、LoDash、UnderScore提供的HTML插值模板默认形似<code>&lt;%= data %&gt;</code>，尽管在默认情况下<code>&lt;%= data %&gt;</code>存在过滤，在编写HTML插值模板时需注意:</p> <ol><li>用户输入流入html属性值时，必须使用双引号包裹：<code>&lt;base data-id = &quot;&lt;%= __USER_INPUT__ %&gt;&quot;&gt;</code></li> <li>用户输入流入<code>&lt;script&gt;&lt;/script&gt;</code>标签或on*的html属性中时，如<code>&lt;script&gt;var id = &lt;%= __USER_INPUT__ %&gt;&lt;/script&gt;</code> ，须按照1.6.3中的做法或白名单方法进行过滤，框架/组件的过滤在此处不起作用</li></ol></li></ul> <p><strong>1.11.3 【必须】在自行实现状态存储容器并将其JSON.Stringify序列化后注入到HTML时，必须进行安全过滤</strong></p> <h4 id="_1-12-url跳转"><a href="#_1-12-url跳转" class="header-anchor">#</a> 1.12 URL跳转</h4> <p><strong>1.12.1【必须】限定跳转目标地址</strong></p> <ul><li>适用场景包括：</li></ul> <ol><li>使用30x返回码并在Header中设置Location进行跳转</li> <li>在返回页面中打印<code>&lt;script&gt;location.href=__Redirection_URL__&lt;/script&gt;</code></li></ol> <ul><li>使用白名单，限定重定向地址的协议前缀（默认只允许HTTP、HTTPS）、域名（默认只允许公司根域），或指定为固定值；</li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 使用express实现的登录成功后的回调跳转页面</span>

<span class="token comment">// bad: 未校验页面重定向地址</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 若未登录用户访问其他页面，则让用户导向到该处理函数进行登录</span>
  <span class="token comment">// 使用参数loginCallbackUrl记录先前尝试访问的url，在登录成功后跳转回loginCallbackUrl:</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> loginCallbackUrl <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>loginCallbackUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>loginCallbackUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good: 白名单限定重定向地址</span>
<span class="token keyword">function</span> <span class="token function">isValidURL</span><span class="token punctuation">(</span><span class="token parameter">sUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(https?:\/\/)?[\w\-.]+\.(qq|tencent)\.com($|\/|\\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[\w][\w/.\-_%]+$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[/\\][^/\\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 若未登录用户访问其他页面，则让用户导向到该处理函数进行登录</span>
  <span class="token comment">// 使用参数loginCallbackUrl记录先前尝试访问的url，在登录成功后跳转回loginCallbackUrl:</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> loginCallbackUrl <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>loginCallbackUrl <span class="token operator">&amp;&amp;</span> <span class="token function">isValidUrl</span><span class="token punctuation">(</span>loginCallbackUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>loginCallbackUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good: 白名单限定重定向地址，通过返回html实现</span>
<span class="token keyword">function</span> <span class="token function">isValidURL</span><span class="token punctuation">(</span><span class="token parameter">sUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(https?:\/\/)?[\w\-.]+\.(qq|tencent)\.com($|\/|\\)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[\w][\w/.\-_%]+$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[/\\][^/\\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>sUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">// 若未登录用户访问其他页面，则让用户导向到该处理函数进行登录</span>
  <span class="token comment">// 使用参数loginCallbackUrl记录先前尝试访问的url，在登录成功后跳转回loginCallbackUrl:</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> loginCallbackUrl <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>loginCallbackUrl <span class="token operator">&amp;&amp;</span> <span class="token function">isValidUrl</span><span class="token punctuation">(</span>loginCallbackUrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 使用encodeURI，过滤左右尖括号与双引号，防止逃逸出包裹的双引号</span>
		<span class="token keyword">const</span> redirectHtml <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;location.href = &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>loginCallbackUrl<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;;&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    	res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>redirectHtml<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p><em>关联漏洞：中风险 - 任意URL跳转漏洞</em></p> <h4 id="_1-13-cookie与登录态"><a href="#_1-13-cookie与登录态" class="header-anchor">#</a> 1.13 Cookie与登录态</h4> <p><strong>1.13.1【推荐】为Cookies中存储的关键登录态信息添加http-only保护</strong></p> <p><strong>1.13.2【推荐】使用p_skey(private_skey)而非skey验证登录态</strong></p> <p><em>关联漏洞：纵深防护措施 - 安全性增强特性</em></p> <h3 id="ii-配置-环境-2"><a href="#ii-配置-环境-2" class="header-anchor">#</a> II. 配置&amp;环境</h3> <h4 id="_2-1-依赖库"><a href="#_2-1-依赖库" class="header-anchor">#</a> 2.1 依赖库</h4> <p><strong>2.1.1【必须】使用安全的依赖库</strong></p> <ul><li>应使用腾讯npm软件源</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm config set registry https://mirrors.tencent.com/npm/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>为什么要这么做？</strong></p> <p>如直接使用npm外部软件源，外部可能会在npm抢注内部私有包，进行包抢注钓鱼攻击（一种供应链攻击），窃取内部机器上的敏感信息。参考：https://security.tencent.com/index.php/blog/msg/185</p></blockquote> <ul><li>定期使用啄木鸟检查依赖库是否存在后门/漏洞，保持最新版本</li></ul> <h4 id="_2-2-运行环境"><a href="#_2-2-运行环境" class="header-anchor">#</a> 2.2 运行环境</h4> <p><strong>2.2.1 【必须】使用非root用户运行Node.js</strong></p> <h4 id="_2-3-配置信息"><a href="#_2-3-配置信息" class="header-anchor">#</a> 2.3 配置信息</h4> <p><strong>2.3.1【必须】禁止硬编码认证凭证</strong></p> <ul><li>禁止在源码中硬编码<code>AK/SK</code>、<code>数据库账密</code>、<code>私钥证书</code>等配置信息</li> <li>应使用配置系统或KMS密钥管理系统。可参考：<a href="https://iwiki.oa.tencent.com/pages/viewpage.action?pageId=40657155" target="_blank" rel="noopener noreferrer">七彩石<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="http://tconf.wsd.com/" target="_blank" rel="noopener noreferrer">tConf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="http://km.oa.com/group/39470/articles/show/419591" target="_blank" rel="noopener noreferrer">腾讯云数据加密解决方案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><strong>2.3.2【必须】禁止硬编码IP配置</strong></p> <ul><li>禁止在源码中硬编码<code>IP</code>信息</li></ul> <blockquote><p><strong>为什么要这么做？</strong></p> <p>硬编码IP可能会导致后续机器裁撤或变更时产生额外的工作量，影响系统的可靠性。</p></blockquote> <p><strong>2.3.3【必须】禁止硬编码员工敏感信息</strong></p> <ul><li>禁止在源代码中含员工敏感信息，包括但不限于：<code>员工ID</code>、<code>手机号</code>、<code>微信/QQ号</code>等。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/17/2024, 8:27:42 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/前端/JavaScript/22.什么是yield.html" class="prev">
        22.什么是 yield
      </a></span> <span class="next"><a href="/前端/JavaScript/24.Class in JS.html">
        24.Class in JS
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.87bfd1af.js" defer></script><script src="/assets/js/2.e7cb0910.js" defer></script><script src="/assets/js/56.4fa9742c.js" defer></script>
  </body>
</html>
