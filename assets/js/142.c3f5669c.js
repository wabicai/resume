(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{438:function(e,v,_){"use strict";_.r(v);var t=_(10),c=Object(t.a)({},(function(){var e=this,v=e._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"_3-webpack-热更新"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-webpack-热更新"}},[e._v("#")]),e._v(" 3.Webpack 热更新")]),e._v(" "),v("p",[e._v("选自：")]),e._v(" "),v("p",[v("a",{attrs:{href:"https://segmentfault.com/a/1190000017387984",target:"_blank",rel:"noopener noreferrer"}},[e._v("Webpack 热更新机制"),v("OutboundLink")],1)]),e._v(" "),v("p",[v("a",{attrs:{href:"https://segmentfault.com/a/1190000017387984",target:"_blank",rel:"noopener noreferrer"}},[e._v("Webpack 如何实现热更新？"),v("OutboundLink")],1)]),e._v(" "),v("h2",{attrs:{id:"热更新原理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#热更新原理"}},[e._v("#")]),e._v(" 热更新原理")]),e._v(" "),v("p",[e._v("https://blog.csdn.net/chern1992/article/details/106893227/")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/gH31uF9VIibQOqf8ia3haGPMK3tUKmlS8ZSDlXjGKdOot13ekiciclzG9vBEev0y6odaMWaQJn2dpr3GnjKDQOBRCw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),e._v(" "),v("ul",[v("li",[e._v("Webpack Compile：将 JS 源代码编译成 bundle.js")]),e._v(" "),v("li",[e._v("HMR Server：用来将热更新的文件输出给 HMR Runtime")]),e._v(" "),v("li",[e._v("Bundle Server：静态资源文件服务器，提供文件访问路径")]),e._v(" "),v("li",[e._v("HMR Runtime：socket 服务器，会被注入到浏览器，更新文件的变化")]),e._v(" "),v("li",[e._v("bundle.js：构建输出的文件")]),e._v(" "),v("li",[e._v("在 HMR Runtime 和 HMR Server 之间建立 websocket，即图上 4 号线，用于实时更新文件变化")])]),e._v(" "),v("p",[e._v("上面图中，可以分成两个阶段：")]),e._v(" "),v("ul",[v("li",[e._v("启动阶段为上图 1 - 2 - A - B")])]),e._v(" "),v("p",[e._v("在编写未经过"),v("code",[e._v("webpack")]),e._v("打包的源代码后，"),v("code",[e._v("Webpack Compile")]),e._v(" 将源代码和 "),v("code",[e._v("HMR Runtime")]),e._v(" 一起编译成 "),v("code",[e._v("bundle")]),e._v("文件，传输给"),v("code",[e._v("Bundle Server")]),e._v(" 静态资源服务器")]),e._v(" "),v("ul",[v("li",[e._v("更新阶段为上图 1 - 2 - 3 - 4")])]),e._v(" "),v("p",[e._v("当某一个文件或者模块发生变化时，"),v("code",[e._v("webpack")]),e._v("监听到文件变化对文件重新编译打包，编译生成唯一的"),v("code",[e._v("hash")]),e._v("值，这个"),v("code",[e._v("hash")]),e._v("值用来作为下一次热更新的标识")]),e._v(" "),v("p",[e._v("根据变化的内容生成两个补丁文件："),v("code",[e._v("manifest")]),e._v("（包含了 "),v("code",[e._v("hash")]),e._v(" 和 "),v("code",[e._v("chundId")]),e._v("，用来说明变化的内容）和"),v("code",[e._v("chunk.js")]),e._v(" 模块")]),e._v(" "),v("p",[e._v("由于"),v("code",[e._v("socket")]),e._v("服务器在"),v("code",[e._v("HMR Runtime")]),e._v(" 和 "),v("code",[e._v("HMR Server")]),e._v("之间建立 "),v("code",[e._v("websocket")]),e._v("链接，当文件发生改动的时候，服务端会向浏览器推送一条消息，消息包含文件改动后生成的"),v("code",[e._v("hash")]),e._v("值，如下图的"),v("code",[e._v("h")]),e._v("属性，作为下一次热更新的标识")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/gH31uF9VIibQOqf8ia3haGPMK3tUKmlS8ZYexoqQRWgnNdRIyRW4mNCtK3s2cvQcERQzBpMOu1uXxuCe4Pia8ZEicw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),e._v(" "),v("p",[e._v("在浏览器接受到这条消息之前，浏览器已经在上一次"),v("code",[e._v("socket")]),e._v(" 消息中已经记住了此时的"),v("code",[e._v("hash")]),e._v(" 标识，这时候我们会创建一个 "),v("code",[e._v("ajax")]),e._v(" 去服务端请求获取到变化内容的 "),v("code",[e._v("manifest")]),e._v(" 文件")]),e._v(" "),v("p",[v("code",[e._v("mainfest")]),e._v("文件包含重新"),v("code",[e._v("build")]),e._v("生成的"),v("code",[e._v("hash")]),e._v("值，以及变化的模块，对应上图的"),v("code",[e._v("c")]),e._v("属性")]),e._v(" "),v("p",[e._v("浏览器根据 "),v("code",[e._v("manifest")]),e._v(" 文件获取模块变化的内容，从而触发"),v("code",[e._v("render")]),e._v("流程，实现局部模块更新")]),e._v(" "),v("p",[v("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/gH31uF9VIibQOqf8ia3haGPMK3tUKmlS8ZZwaZ6UuIaopRicvmLlicyRYqUFzRV1ca8KygK0lkM7Ediaeich7vd8ndaw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"图片"}})]),e._v(" "),v("h2",{attrs:{id:"三、总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#三、总结"}},[e._v("#")]),e._v(" 三、总结")]),e._v(" "),v("p",[e._v("关于"),v("code",[e._v("webpack")]),e._v("热模块更新的总结如下：")]),e._v(" "),v("ul",[v("li",[e._v("通过"),v("code",[e._v("webpack-dev-server")]),e._v("创建两个服务器：提供静态资源的服务（express）和 Socket 服务")]),e._v(" "),v("li",[e._v("express server 负责直接提供静态资源的服务（打包后的资源直接被浏览器请求和解析）")]),e._v(" "),v("li",[e._v("socket server 是一个 websocket 的长连接，双方可以通信")]),e._v(" "),v("li",[e._v("当 socket server 监听到对应的模块发生变化时，会生成两个文件.json（manifest 文件）和.js 文件（update chunk）")]),e._v(" "),v("li",[e._v("通过长连接，socket server 可以直接将这两个文件主动发送给客户端（浏览器）")]),e._v(" "),v("li",[e._v("浏览器拿到两个新的文件后，通过 HMR runtime 机制，加载这两个文件，并且针对修改的模块进行更新")])])])}),[],!1,null,null,null);v.default=c.exports}}]);