(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{465:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_4-浏览器的六种本地缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-浏览器的六种本地缓存"}},[t._v("#")]),t._v(" 4.浏览器的六种本地缓存")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#4%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%85%AD%E7%A7%8D%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98"}},[t._v("4.浏览器的六种本地缓存")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%82%A8%E5%AD%98%E5%B0%91%E9%87%8F%E6%95%B0%E6%8D%AE-cookiesessionstorage-%E5%92%8C-localstorage"}},[t._v("储存少量数据： cookie，sessionStorage 和 localStorage")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#11-cookie-%E8%AF%A6%E8%A7%A3"}},[t._v("1.1 cookie 详解")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"}},[t._v("常用属性：")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#cookie-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"}},[t._v("Cookie 的生命周期")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%82%A8%E5%AD%98%E5%A4%A7%E9%87%8F%E6%95%B0%E6%8D%AEindexdb"}},[t._v("储存大量数据：IndexDB")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#indexdb"}},[t._v("indexDB：")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E7%A6%BB%E7%BA%BF%E7%BC%93%E5%AD%98application-cache"}},[t._v("离线缓存：Application Cache")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"}},[t._v("使用方式")])])])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%B7%A5%E4%BD%9C%E7%BA%BF%E7%A8%8B%E7%BC%93%E5%AD%98cachestorage"}},[t._v("工作线程缓存：cacheStorage")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"}},[t._v("应用场景")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E5%9B%9B-cookie-%E5%92%8C-session-%E7%9A%84%E9%97%AE%E9%A2%98"}},[t._v("四、 cookie 和 session 的问题")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#cookie-%E7%9A%84%E8%B7%A8%E5%9F%9F%E5%85%B1%E4%BA%AB"}},[t._v("Cookie 的跨域共享")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"#%E6%B5%8F%E8%A7%88%E5%99%A8-cookie-%E7%9A%84-same-site"}},[t._v("浏览器 cookie 的 same-site")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#cors"}},[t._v("CORS")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E5%A6%82%E6%9E%9C%E4%BD%8D%E4%BA%8E%E5%90%8C%E4%B8%AA%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8Dsso-%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95"}},[t._v("如果位于同个二级域名（SSO 单点登录）")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#%E9%99%8D%E5%9F%9F"}},[t._v("降域")])]),t._v(" "),s("li",[s("a",{attrs:{href:"#nginx-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"}},[t._v("nginx 反向代理")])])])])])])])])]),t._v(" "),s("h2",{attrs:{id:"储存少量数据-cookie-sessionstorage-和-localstorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#储存少量数据-cookie-sessionstorage-和-localstorage"}},[t._v("#")]),t._v(" 储存少量数据： cookie，sessionStorage 和 localStorage")]),t._v(" "),s("p",[s("strong",[t._v("相同点")]),t._v("：cookie，sessionStorage 和 localStorage 都是"),s("strong",[t._v("存储在浏览器端")]),t._v("的。")]),t._v(" "),s("p",[s("strong",[t._v("不同点")]),t._v("：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("cookie")]),t._v("数据始终在浏览器请求中被携带，在"),s("strong",[t._v("浏览器端和服务器端来回传递")]),t._v("的；"),s("strong",[t._v("sessStorage 和 localStorage")]),t._v("同属"),s("strong",[t._v("于 webStorage")]),t._v("，"),s("strong",[t._v("仅在本地保存")]),t._v("，不会传递到服务器端")]),t._v(" "),s("li",[t._v("存活时间："),s("strong",[t._v("cookie 在设置的存活时间之前一直有效")]),t._v("，"),s("strong",[t._v("sessionStorage")]),t._v("在浏览器"),s("strong",[t._v("窗口关闭之前")]),t._v("一直有效，"),s("strong",[t._v("localStorage 始终有效")])]),t._v(" "),s("li",[t._v("存储大小："),s("strong",[t._v("cookie 只有 4KB")]),t._v("，sessionStorage 和 localStorage 存储空间大一些("),s("strong",[t._v("大概 5Mb 左右")]),t._v("）")]),t._v(" "),s("li",[t._v("作用域："),s("strong",[t._v("sessionStorage 不在不同的浏览器窗口中共享，即使同一个页面")]),t._v("，\n而 cookie 和 localStorage 在"),s("strong",[t._v("同源窗口")]),t._v("（协议、域名、端口相同）中均"),s("strong",[t._v("共享")])]),t._v(" "),s("li",[t._v("储存类型：webStorage 只能存字符串，无法直接存对象。cookie 存的是文本文件。")])]),t._v(" "),s("h3",{attrs:{id:"_1-1-cookie-详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-cookie-详解"}},[t._v("#")]),t._v(" 1.1 cookie 详解")]),t._v(" "),s("h5",{attrs:{id:"常用属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用属性"}},[t._v("#")]),t._v(" 常用属性：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("Secure")]),t._v(" => cookie 只有通过 HTTPS 加密过才能发送给服务端")]),t._v(" "),s("ul",[s("li",[t._v("修改 cookie 时，domain 和 path 都相同才可以进行，有不同则创建一个新的 cookie")]),t._v(" "),s("li",[t._v("cookie 过期就会被浏览器删除")]),t._v(" "),s("li",[t._v("有助于避免 XSS 攻击")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("HTTPOnly")]),t._v(" => 只允许通过请求访问 cookie，避免 document.cookie 方式攻击，有助于避免 CSRF 攻击")])]),t._v(" "),s("li",[s("p",[t._v("二级域名能读取设置了 domain 为顶级域名或者自身的 cookie，不能读取其他二级域名 domain 的 cookie。例如：要想 cookie 在多个二级域名中共享，需要设置 domain 为顶级域名，这样就可以在所有二级域名里面或者到这个 cookie 的值了。")])]),t._v(" "),s("li",[s("p",[t._v("顶级域名只能获取到 domain 设置为顶级域名的 cookie，domain 设置为其他子级域名的无法获取。")])])]),t._v(" "),s("h3",{attrs:{id:"cookie-的生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie-的生命周期"}},[t._v("#")]),t._v(" Cookie 的生命周期")]),t._v(" "),s("p",[t._v("服务端一般都会给其设置一个过期时间 maxAge，短则 1 小时、1 天，长则 1 星期、1 个月甚至永久，这就是 Cookie 的生命(周期)。")]),t._v(" "),s("p",[t._v("Cookie 的存储形式，根据其生命周期的不同而不同。这由 maxAge 属性决定，共有这三种情况：")]),t._v(" "),s("ol",[s("li",[t._v("maxAge > 0：cookie 不仅内存里有，还会持久化到硬盘，也叫持久 Cookie。这样的话即使你关机重启(甚至过几天再访问)，这个 cookie 依旧存在，请求时依旧会携带")]),t._v(" "),s("li",[t._v("maxAge < 0：一般值为-1，也就临时 Cookie。该 Cookie 只在内存中有(如 session 级别)，一旦管理浏览器此 Cookie 将不复存在。值得注意的是：若使用无痕模式访问也是不会携带此 Cookie 的哟")]),t._v(" "),s("li",[t._v("maxAge = 0：内存中没有，硬盘中也没有了，也就立即删除 Cookie。此种 case 存在的唯一目的：服务浏览器可能的已存在的 cookie，让其立马失效(消失)\n❝Tips：请注意 maxAge<0(负数)和 maxAge=0 的区别。前者会存在于内存，只有关闭浏览器 or 重启才失效;后者是立即删除 ❞ 当然啦，Cookie 的生命周期除了受到后端设置的 Age 值来决定外，还有两种方式可“改变”它：")])]),t._v(" "),s("h2",{attrs:{id:"储存大量数据-indexdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#储存大量数据-indexdb"}},[t._v("#")]),t._v(" 储存大量数据：IndexDB")]),t._v(" "),s("h3",{attrs:{id:"indexdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#indexdb"}},[t._v("#")]),t._v(" indexDB：")]),t._v(" "),s("p",[t._v("特性：")]),t._v(" "),s("ol",[s("li",[t._v("储存量理论没有上限")]),t._v(" "),s("li",[t._v("操作是异步的。 loaclStorage 是同步的。操作性能高")]),t._v(" "),s("li",[t._v("支持储存 JS 的对象")]),t._v(" "),s("li",[t._v("是正经的数据库，数据库能干的他都可以")])]),t._v(" "),s("p",[t._v("缺点：")]),t._v(" "),s("ol",[s("li",[t._v("操作繁琐")]),t._v(" "),s("li",[t._v("本身有门槛")])]),t._v(" "),s("h2",{attrs:{id:"离线缓存-application-cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#离线缓存-application-cache"}},[t._v("#")]),t._v(" 离线缓存：Application Cache")]),t._v(" "),s("p",[t._v("HTML5 引入了应用程序缓存（Application Cache），这意味着可对 web 应用进行缓存，并可在没有因特网连接时进行访问。")]),t._v(" "),s("p",[t._v("应用程序缓存为应用带来三个优势：")]),t._v(" "),s("ol",[s("li",[t._v("离线浏览 - 用户可在应用离线时使用它们")]),t._v(" "),s("li",[t._v("速度 - 已缓存资源加载得更快")]),t._v(" "),s("li",[t._v("减少服务器负载 - 浏览器将只从服务器下载更新过或更改过的资源")])]),t._v(" "),s("h3",{attrs:{id:"使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[t._v("#")]),t._v(" 使用方式")]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("HTML")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("manifest")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("demo.appcache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n...\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("ul",[s("li",[t._v('注意：manifest 文件需要设置正确的 MIME-type，即 "text/cache-manifest"。必须在 web 服务器上进行配置。')]),t._v(" "),s("li",[t._v("注释：浏览器对缓存数据的容量限制可能不太一样（某些浏览器的限制是每个站点 5MB）。")]),t._v(" "),s("li",[t._v("一旦文件被缓存，则浏览器会继续展示已缓存的版本，即使您修改了服务器上的文件。为了确保浏览器更新缓存，您需要更新 manifest 文件。")])]),t._v(" "),s("h2",{attrs:{id:"工作线程缓存-cachestorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工作线程缓存-cachestorage"}},[t._v("#")]),t._v(" 工作线程缓存：cacheStorage")]),t._v(" "),s("ul",[s("li",[t._v("是在 service workers 规范中定义的，但可以用在其他工作线程")]),t._v(" "),s("li",[t._v("主要用途是用于对请求的缓存")])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" testCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cacheName "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'baidu'")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义cache名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path'")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义路径")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cachesMatch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 匹配当前路径")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cachesLocal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("has")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果当前已有数据则直接获取缓存的数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cachesMatch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" cachesLocal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"获取cache数据: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果没有则获取远程数据")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBaidu")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将请求的数据保存在caches中")]),t._v("\n        caches"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cacheName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Response")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("status")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 采用Json数据格式保存")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br")])]),s("p",[s("a",{attrs:{href:"https://www.zhangxinxu.com/wordpress/2017/07/service-worker-cachestorage-offline-develop/",target:"_blank",rel:"noopener noreferrer"}},[t._v("结合 serviceWorker 和 cacheStorage 实现请求缓存"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[t._v("#")]),t._v(" 应用场景")]),t._v(" "),s("ol",[s("li",[t._v("cookie：标记用户与跟踪用户行为")]),t._v(" "),s("li",[t._v("localStorage：长期保存在本地的数据（令牌）")]),t._v(" "),s("li",[t._v("sessionStorage：敏感账号一次性登陆")]),t._v(" "),s("li",[t._v("indexDB：储存大量数据、在线文档（富文本编辑器）、保存编辑历史。")])]),t._v(" "),s("h3",{attrs:{id:"四、-cookie-和-session-的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、-cookie-和-session-的问题"}},[t._v("#")]),t._v(" 四、 cookie 和 session 的问题")]),t._v(" "),s("ol",[s("li",[t._v("cookie 不安全，本地可以直接拿到")]),t._v(" "),s("li",[t._v("session 访问多会占用服务器性能")]),t._v(" "),s("li",[t._v("session 不支持分布式，会有负载均衡问题")])]),t._v(" "),s("h3",{attrs:{id:"cookie-的跨域共享"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie-的跨域共享"}},[t._v("#")]),t._v(" Cookie 的跨域共享")]),t._v(" "),s("p",[t._v("要实现 Cookie 的跨域共享，有 3 个关键点：")]),t._v(" "),s("ol",[s("li",[t._v("服务端负责在响应中将 Set-Cookie 发出来(由 Access-Control-Allow-Credentials 响应头决定 设置 true)(服务端能正确的在响应中有"),s("strong",[t._v("Set-Cookie")]),t._v("响应)")]),t._v(" "),s("li",[t._v("浏览器端只要响应里有 Set-Cookie 头，就将此 Cookie 存储(由异步对象的 XMLHttpRequest 对象的 withCredentials 属性决定 设置 true)")]),t._v(" "),s("li",[t._v("浏览器端发现只要有 Cookie，即使是跨域请求也将其带着(由异步对象的 withCredentials 属性决定)\n(当异步对象设置了"),s("strong",[t._v("withCredentials=true")]),t._v("时，浏览器会保留下响应的 Cookie 等信息，并且下次发送请求时将其携带。因此要指示浏览器存储 Cookie 并且每次跨域请求都携带，仅需加上此参数，此时服务端的"),s("strong",[t._v("Access-Control-Allow-Origin")]),t._v("这个响应头的值不能是通配符*，而只能是具体的值)")])]),t._v(" "),s("h4",{attrs:{id:"浏览器-cookie-的-same-site"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器-cookie-的-same-site"}},[t._v("#")]),t._v(" 浏览器 cookie 的 same-site")]),t._v(" "),s("ol",[s("li",[t._v("Strict（禁止第三方 cookie）")]),t._v(" "),s("li",[t._v("Lax 稍微严格一点")]),t._v(" "),s("li",[t._v("None（Secure 必须为 true）")])]),t._v(" "),s("h4",{attrs:{id:"cors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),s("ol",[s("li",[t._v("withCridential")]),t._v(" "),s("li",[t._v("后端配置"),s("code",[t._v("Access-Control-Allow-Credentials")])])]),t._v(" "),s("h4",{attrs:{id:"如果位于同个二级域名-sso-单点登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如果位于同个二级域名-sso-单点登录"}},[t._v("#")]),t._v(" 如果位于同个二级域名（SSO 单点登录）")]),t._v(" "),s("ol",[s("li",[t._v("将 cookie 存在二级域名下")])]),t._v(" "),s("h4",{attrs:{id:"降域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#降域"}},[t._v("#")]),t._v(" 降域")]),t._v(" "),s("ol",[s("li",[t._v("将某个二级域名的 path 设置跟另外一个域名相同")])]),t._v(" "),s("h4",{attrs:{id:"nginx-反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-反向代理"}},[t._v("#")]),t._v(" nginx 反向代理")]),t._v(" "),s("ol",[s("li",[t._v("proxy_cookie_domain 做 cookie 域名转换")]),t._v(" "),s("li",[t._v("转换 response 的 set-cookie header 中的 domain 选项，由后端设置的域名 domain 转换成你的域名 replacement")])])])}),[],!1,null,null,null);s.default=n.exports}}]);